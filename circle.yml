machine:
  services:
    - cassandra

dependencies:
    pre:
        - "bash .ci/setup_kong.sh"
        - "while ! cqlsh -e 'exit'; do :; done"
    post:
        - sudo make dev
test:
    override:
        - busted -o junit ./spec/unit > $CIRCLE_TEST_REPORTS/junit_unit.xml
        - busted -o junit ./spec/integration > $CIRCLE_TEST_REPORTS/junit_integration.xml
        - busted -o junit ./spec/plugins > $CIRCLE_TEST_REPORTS/junit_plugins.xml
        - busted -o spec/busted-print.lua --coverage spec/
    post:
        - make lint
